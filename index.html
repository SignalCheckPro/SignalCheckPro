<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>SignalCheck Pro 3.0</title>

  <!-- PWA Manifest & Theme -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1c2331">
  <link rel="apple-touch-icon" href="icons/icon-192x192.png">

  <!-- Stylesheet -->
  <link rel="stylesheet" href="style.css">

</head>
<body>
  
  <main id="app-container">
    <header>
      <h1>SignalCheck Pro 3.0</h1>
      <p>Herramienta PWA de Calibración y Certificación de Instrumentos</p>
    </header>

    <!-- Paso 1: Hoja de Datos del Instrumento -->
    <section id="step-1-datasheet" class="app-step active">
      <form id="instrumentForm">
        <fieldset>
          <legend><h2>Paso 1: Hoja de Datos del Instrumento</h2></legend>
          <div class="input-grid">
            <div class="input-group">
              <label for="tag">TAG del Instrumento</label>
              <input type="text" id="tag" required placeholder="Ej: PT-101">
            </div>
            <div class="input-group">
              <label for="brand">Marca</label>
              <input type="text" id="brand" required placeholder="Ej: Siemens">
            </div>
            <div class="input-group">
              <label for="model">Modelo</label>
              <input type="text" id="model" required placeholder="Ej: 335">
            </div>
            <div class="input-group">
              <label for="power">Alimentación</label>
              <input type="text" id="power" required placeholder="Ej: 24 VDC">
            </div>
            <div class="input-group">
              <label for="type">Tipo de Instrumento</label>
              <input type="text" id="type" required placeholder="Ej: Presión">
            </div>
            <div class="input-group">
              <label for="unit">Unidad de Medida</label>
              <input type="text" id="unit" required placeholder="Ej: psi, bar, %">
            </div>
            <div class="input-group">
              <label for="lrv">Valor Mínimo del Rango (LRV)</label>
              <input type="number" id="lrv" required placeholder="Ej: 0">
            </div>
            <div class="input-group">
              <label for="urv">Valor Máximo del Rango (URV)</label>
              <input type="number" id="urv" required placeholder="Ej: 100">
            </div>
            <div class="input-group">
              <label for="errorThreshold">Umbral de Error Máx. (%)</label>
              <input type="number" id="errorThreshold" step="0.01" required placeholder="Ej: 0.5">
            </div>
          </div>
        </fieldset>
        <div class="button-group-vertical">
          <button type="submit" id="saveInstrumentBtn" class="btn-primary">Siguiente</button>
        </div>
      </form>
    </section>

    <!-- Paso 2: Puntos de Calibración -->
    <section id="step-2-calibration" class="app-step">
      <div id="calibration-table-container">
        <h2>Paso 2: Registro de Datos</h2>
        <table>
          <thead>
            <tr>
              <th>%</th>
              <th>Ideal (<span id="ideal-unit"></span>)</th>
              <th>Medido (<span id="measured-unit"></span>)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>0%</td>
              <td class="ideal-value">0.0</td>
              <td><input type="number" class="measured-input" required step="0.01"></td>
            </tr>
            <tr>
              <td>25%</td>
              <td class="ideal-value">0.0</td>
              <td><input type="number" class="measured-input" required step="0.01"></td>
            </tr>
            <tr>
              <td>50%</td>
              <td class="ideal-value">0.0</td>
              <td><input type="number" class="measured-input" required step="0.01"></td>
            </tr>
            <tr>
              <td>75%</td>
              <td class="ideal-value">0.0</td>
              <td><input type="number" class="measured-input" required step="0.01"></td>
            </tr>
            <tr>
              <td>100%</td>
              <td class="ideal-value">0.0</td>
              <td><input type="number" class="measured-input" required step="0.01"></td>
            </tr>
            <!-- Fila para mostrar los errores -->
            <tr id="error-values-row" class="hidden">
              <td class="table-header">Error</td>
              <td></td>
              <td class="error-value"></td>
              <td class="error-value"></td>
              <td class="error-value"></td>
              <td class="error-value"></td>
              <td class="error-value"></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="button-group-vertical">
        <button id="validateBtn" class="btn-primary">Validar y Ver Resultados</button>
        <button id="backToDataBtn" class="btn-secondary">Volver a Datos del Instrumento</button>
      </div>
    </section>

    <!-- Paso 3: Resultados y Generación de Reporte -->
    <section id="step-3-report" class="app-step">
      <h2>Paso 3: Resultados y Reporte</h2>
      <div id="summary-card">
        <h3>Resumen de la Calibración</h3>
        <p><strong>TAG:</strong> <span id="summary-tag"></span></p>
        <p><strong>Resultado:</strong> <span id="summary-result"></span></p>
        <p><strong>Fecha:</strong> <span id="summary-date"></span></p>
        <div class="chart-container">
          <canvas id="chart"></canvas>
        </div>
        <p id="summary-equation" class="hidden"></p>
      </div>
      <div class="button-group-vertical">
        <button id="generatePdfBtn" class="btn-export">
            <span class="btn-text">Generar Reporte PDF</span>
            <div class="spinner hidden"></div>
        </button>
        <button id="fullResetBtn" class="btn-secondary">Iniciar Nueva Prueba</button>
      </div>
    </section>

    <div id="error-message" class="hidden" aria-live="polite"></div>
  </main>
  
  <!-- Librerías JS Externas (Cargadas al final y de forma asíncrona) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js" defer></script>

  <!-- Archivos de la Aplicación -->
  <script type="module" src="app.js"></script>
</body>
</html>
